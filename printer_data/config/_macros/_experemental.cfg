[gcode_macro INTRO_PURGE]
description: Fast purge before printing
gcode:
    SAVE_GCODE_STATE NAME=INTRO_PURGE_STATE
    {% set DIST = params.DIST|default(20)|float %}  ; default 20mm
    RESPOND MSG="QUICK_PURGE_SIMPLE {DIST}mm"
    {% set St = (printer["gcode_macro _PURGE_BUCKET_VARIABLES"].travel_speed * 60) %}
    {% set Bx, By, Bz = printer["gcode_macro _PURGE_BUCKET_VARIABLES"].brush_xyz|map('float') %}
    {% set brush_speed = printer["gcode_macro _PURGE_BUCKET_VARIABLES"].brush_clean_speed %}
    G90
    MOVE_TO_PURGE_BUCKET
    G92 E0
    G1 E{DIST} F600            ; quick extrusion
    G92 E0
    G1 E-3 F2100               ; small retract
    G91
    G1 Z3                      ; small lift
    G90
    G1 X{Bx} Y{By} Z{Bz} F{St}
    G91
    G1 X+36 F{brush_speed}
    G1 X-36 F{brush_speed}
    G1 Y-1 F{brush_speed}
    G1 Z+10 F{St}
    G90
    RESTORE_GCODE_STATE NAME=INTRO_PURGE_STATE
